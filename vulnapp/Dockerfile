FROM ubuntu:23.10

LABEL name="CVE-2024-29510 Demo"
LABEL version="1.0"
LABEL description="Based on https://codeanlabs.com/blog/research/cve-2024-29510-ghostscript-format-string-exploitation/"

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get update -y \
	&& apt-get install -y wget build-essential python3 python3-pip

WORKDIR /opt

COPY ghostscript-10.02.1.tar.gz .

RUN tar -vxzf ghostscript-10.02.1.tar.gz

WORKDIR /opt/ghostscript-10.02.1

RUN ./configure && make && make install && ln -s /usr/local/bin/gs /usr/local/bin/ghostscript

WORKDIR /app

RUN apt-get install -y python3-venv && python3 -m venv . && . bin/activate && pip3 install flask

RUN mkdir uploads output templates

COPY app.py .

COPY templates/index.html templates/index.html

ENV PATH=/app/bin:$PATH

ENTRYPOINT ["flask", "run", "--host", "0.0.0.0"]
